---
- name: Deploy Docker Image to Docker Hub
  hosts: web01
  tasks:
    - name: Create docker directory on Docker server
      file:
        path: /home/docker
        state: directory
        mode: '0755'

    - name: Copy required files to Docker server
      copy:
        src: "{{ item }}"
        dest: /home/docker/
      loop:
        - /var/lib/jenkins/workspace/sample/Dockerfile
        - /var/lib/jenkins/workspace/sample/webapp/target/webapp.war
        - /var/lib/jenkins/workspace/sample/regapp-deploy.yml

    - name: Build Docker Image using shell command
      shell: |
        docker build -t {{ dockerhub_username }}/{{ image_name }}:{{ image_tag }} /home/docker
      args:
        chdir: /home/docker

    - name: Push Docker Image to Docker Hub using shell command
      shell: |
        docker push {{ dockerhub_username }}/{{ image_name }}:{{ image_tag }}

  vars:
    dockerhub_username: "rakarun"
    image_name: "regapp"
    image_tag: "latest"

